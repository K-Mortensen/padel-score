<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padel Score</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">â˜€ï¸</button>

    <h1>PADEL SCORE</h1>
    <p class="subtitle">Track Â· Play Â· Win</p>

    <div class="sync-bar">
        <div class="sync-info">
            <div class="sync-dot" id="syncDot"></div>
            <div class="sync-text">
                <div class="sync-label">Shared Scoreboard</div>
                <div class="sync-sub" id="syncSub">Connectingâ€¦</div>
            </div>
        </div>
        <button class="sync-btn" id="syncRefreshBtn" onclick="loadFromServer()">â†» Refresh</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('play')">âš¡ Play</button>
        <button class="tab-btn" onclick="switchTab('history')">ğŸ“Š Stats</button>
        <button class="tab-btn" onclick="switchTab('elo')">ğŸ† Elo</button>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-content active" id="tab-play">

        <!-- FORMAT SELECTOR -->
        <div class="format-row">
            <span class="format-label">FORMAT:</span>
            <button class="format-btn active" id="format2v2" onclick="setFormat('2v2')">ğŸ‘¥ 2 vs 2</button>
            <button class="format-btn" id="format1v1" onclick="setFormat('1v1')">ğŸ§ 1 vs 1</button>
        </div>

        <div class="input-section">
            <div class="input-row" id="inputRow1">
                <span class="player-num">1</span>
                <input type="text" id="p1" placeholder="Player one" oninput="onPlayerInput()" />
                <span class="input-elo-badge provisional" id="elo-p1">â€”</span>
            </div>
            <div class="input-row" id="inputRow2">
                <span class="player-num">2</span>
                <input type="text" id="p2" placeholder="Player two" oninput="onPlayerInput()" />
                <span class="input-elo-badge provisional" id="elo-p2">â€”</span>
            </div>
            <div class="input-row" id="inputRow3">
                <span class="player-num">3</span>
                <input type="text" id="p3" placeholder="Player three" oninput="onPlayerInput()" />
                <span class="input-elo-badge provisional" id="elo-p3">â€”</span>
            </div>
            <div class="input-row" id="inputRow4">
                <span class="player-num">4</span>
                <input type="text" id="p4" placeholder="Player four" oninput="onPlayerInput()" />
                <span class="input-elo-badge provisional" id="elo-p4">â€”</span>
            </div>
            <p class="error" id="error"></p>
        </div>

        <div class="team-mode-row">
            <button class="mode-btn active" id="modeRandom" onclick="setMode('random')">ğŸ”€ Random Teams</button>
            <button class="mode-btn" id="modeManual" onclick="setMode('manual')">âœï¸ Pick Teams</button>
        </div>

        <div class="manual-teams" id="manualTeams">
            <div class="manual-team-box">
                <div class="manual-team-label">âš¡ Team A â€” Pick 2 Players</div>
                <div class="manual-team-picks" id="picksA"></div>
                <div class="manual-team-slots" id="slotsA">
                    <span style="font-size:0.75rem;color:var(--text-faint);letter-spacing:0.1em;">â€” no players selected â€”</span>
                </div>
            </div>
            <div class="manual-team-box">
                <div class="manual-team-label" style="color:#7ab3e0;">ğŸŒŠ Team B â€” Pick 2 Players</div>
                <div class="manual-team-picks" id="picksB"></div>
                <div class="manual-team-slots" id="slotsB">
                    <span style="font-size:0.75rem;color:var(--text-faint);letter-spacing:0.1em;">â€” no players selected â€”</span>
                </div>
            </div>
        </div>

        <button class="btn" id="generateBtn" onclick="generateTeams()">Generate Teams</button>

        <div class="court-wrapper" id="courtWrapper">
            <p class="match-title">âš¡ Today's Match</p>
            <div class="court">
                <div class="court-lines">
                    <div class="line-v"></div>
                    <div class="line-h-left"></div>
                    <div class="line-h-right"></div>
                </div>

                <!-- Corner team name labels -->
                <div class="corner-label corner-label-a" id="cornerLabelA">TEAM A</div>
                <div class="corner-label corner-label-b" id="cornerLabelB">TEAM B</div>

                <div class="court-elo-matchup" id="courtEloMatchup">ELO â€”</div>

                <div class="side side-left">
                    <div class="player-card" id="playerCard1A">
                        <div class="player-name" id="a1">â€”</div>
                        <div class="player-elo" id="a1elo">â€”</div>
                        <div class="player-label">Player</div>
                    </div>
                    <div class="player-card" id="playerCard2A">
                        <div class="player-name" id="a2">â€”</div>
                        <div class="player-elo" id="a2elo">â€”</div>
                        <div class="player-label">Player</div>
                    </div>
                    <div class="team-elo-bar">
                        <span>ELO</span>
                        <span class="team-elo-value" id="teamAElo">â€”</span>
                    </div>
                </div>

                <div class="net">
                    <div class="net-post-top"></div>
                    <div class="net-mesh"></div>
                    <div class="net-post-bottom"></div>
                </div>

                <div class="side side-right">
                    <div class="player-card" id="playerCard1B">
                        <div class="player-name" id="b1">â€”</div>
                        <div class="player-elo" id="b1elo">â€”</div>
                        <div class="player-label">Player</div>
                    </div>
                    <div class="player-card" id="playerCard2B">
                        <div class="player-name" id="b2">â€”</div>
                        <div class="player-elo" id="b2elo">â€”</div>
                        <div class="player-label">Player</div>
                    </div>
                    <div class="team-elo-bar">
                        <span>ELO</span>
                        <span class="team-elo-value" id="teamBElo">â€”</span>
                    </div>
                </div>
            </div>

            <p class="vs-badge">TEAM A &nbsp;VS&nbsp; TEAM B</p>
            <button class="regenerate" id="shuffleBtn" onclick="shuffle()">ğŸ”€ Shuffle Teams</button>

            <div class="score-section">
                <h3>ğŸ† Save Match Result</h3>
                <div class="score-inputs">
                    <div class="score-team">
                        <div class="score-team-name" id="scoreTeamA">TEAM A</div>
                        <input class="score-input" type="number" id="scoreA" min="0" max="99" placeholder="0" oninput="updateEloPreview()" />
                    </div>
                    <div class="score-vs">VS</div>
                    <div class="score-team">
                        <div class="score-team-name" id="scoreTeamB">TEAM B</div>
                        <input class="score-input" type="number" id="scoreB" min="0" max="99" placeholder="0" oninput="updateEloPreview()" />
                    </div>
                </div>
                <div class="elo-preview">
                    <div class="elo-preview-team">
                        <div class="elo-preview-label">A Elo After</div>
                        <div class="elo-preview-val" id="previewA">â€”</div>
                        <div class="elo-change-hint" id="previewADelta"></div>
                    </div>
                    <div class="elo-preview-sep">âš¡</div>
                    <div class="elo-preview-team">
                        <div class="elo-preview-label">B Elo After</div>
                        <div class="elo-preview-val" id="previewB">â€”</div>
                        <div class="elo-change-hint" id="previewBDelta"></div>
                    </div>
                </div>
                <button class="save-btn" id="saveBtn" onclick="saveMatch()">ğŸ’¾ Save Result</button>
                <div class="save-success" id="saveSuccess"></div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HISTORY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-content" id="tab-history">
        <div class="history-controls">
            <button class="btn-export" onclick="exportData()">â¬‡ Export JSON</button>
        </div>
        <div class="stats-grid" id="statsGrid">
            <div class="no-history" style="grid-column:1/-1">Loadingâ€¦</div>
        </div>
        <div class="date-filter-bar">
            <span class="date-filter-label">ğŸ—“ Filter:</span>
            <input class="date-input" type="date" id="filterFrom" onchange="renderHistory()" />
            <span class="date-filter-sep">â†’</span>
            <input class="date-input" type="date" id="filterTo" onchange="renderHistory()" />
            <button class="btn-clear-filter" onclick="clearDateFilter()">âœ• Clear</button>
        </div>
        <div class="section-label">Match History</div>
        <div class="match-list" id="matchList">
            <div class="no-history">Loadingâ€¦</div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ELO TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-content" id="tab-elo">
        <div class="elo-tab-content">
            <div class="elo-header">
                <div class="elo-header-title">âš¡ Elo Power Rankings</div>
                <div class="elo-header-desc" id="eloHeaderDesc">Team 2v2 rankings Â· Starting Elo 1200 Â· K-factor 32 Â· Min 3 games for ranked status Â· Click a player for details</div>
            </div>

            <!-- 1v1 / 2v2 toggle -->
            <div class="elo-view-toggle">
                <button class="elo-view-btn active" id="eloView2v2" onclick="setEloTabView('2v2')">ğŸ‘¥ 2v2</button>
                <button class="elo-view-btn" id="eloView1v1" onclick="setEloTabView('1v1')">ğŸ§ 1v1</button>
            </div>

            <div class="elo-leaderboard" id="eloLeaderboard">
                <div class="no-history">Loadingâ€¦</div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EDIT MATCH MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal-overlay" id="editModal" style="display:none;" onclick="handleModalOverlayClick(event,'editModal')">
        <div class="modal">
            <div class="modal-title">âœï¸ Edit Match</div>
            <div class="modal-teams">
                <div>
                    <div class="modal-team-label team-a">âš¡ Team A</div>
                    <input class="modal-name-input" id="editA1" type="text" placeholder="Player 1" />
                    <span id="editA2Row"><input class="modal-name-input" id="editA2" type="text" placeholder="Player 2" /></span>
                </div>
                <div class="modal-vs-col"><span class="modal-vs">VS</span></div>
                <div>
                    <div class="modal-team-label team-b">ğŸŒŠ Team B</div>
                    <input class="modal-name-input" id="editB1" type="text" placeholder="Player 1" />
                    <span id="editB2Row"><input class="modal-name-input" id="editB2" type="text" placeholder="Player 2" /></span>
                </div>
            </div>
            <div class="modal-score-row">
                <div>
                    <div class="modal-score-label">SCORE A</div>
                    <input class="modal-score-input" type="number" id="editScoreA" min="0" max="99" placeholder="0" />
                </div>
                <div class="modal-vs">â€“</div>
                <div>
                    <div class="modal-score-label">SCORE B</div>
                    <input class="modal-score-input" type="number" id="editScoreB" min="0" max="99" placeholder="0" />
                </div>
            </div>
            <div class="modal-datetime-row">
                <div class="modal-datetime-label">ğŸ“… Date & Time</div>
                <input class="modal-datetime-input" type="datetime-local" id="editDateTime" />
            </div>
            <div class="modal-buttons">
                <button class="modal-btn-cancel" onclick="closeModal('editModal')">Cancel</button>
                <button class="modal-btn-save" id="editSaveBtn" onclick="saveEdit()">ğŸ’¾ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAYER STATS MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal-overlay" id="playerModal" style="display:none;" onclick="handleModalOverlayClick(event,'playerModal')">
        <div class="player-modal">
            <div class="player-modal-header">
                <div class="player-modal-name-group">
                    <div class="player-modal-name" id="pmName">PLAYER</div>
                    <div class="player-modal-elo" id="pmEloDisplay">ELO â€”</div>
                </div>
                <button class="modal-close-btn" onclick="closeModal('playerModal')">âœ•</button>
            </div>
            <div class="player-stats-grid" id="pmStatsGrid"></div>
            <div class="player-winrate-section">
                <div class="player-winrate-label">
                    <span>Win Rate</span>
                    <span id="pmWinratePct">0%</span>
                </div>
                <div class="player-winrate-bar">
                    <div class="player-winrate-fill" id="pmWinrateFill" style="width:0%"></div>
                </div>
            </div>
            <div class="player-elo-section">
                <div class="player-elo-section-title">
                    <span>2v2 Elo History</span>
                    <span id="pmEloPeak" style="font-size:0.7rem;letter-spacing:0.1em;color:var(--text-muted);font-family:'DM Sans',sans-serif;font-weight:400;"></span>
                </div>
                <div class="elo-spark" id="pmEloSpark"></div>
            </div>
            <div class="player-matches-title">Match History</div>
            <div id="pmMatchList"></div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="js/state.js"></script>
    <script src="js/elo.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/teams.js"></script>
    <script src="js/history.js"></script>
    <script src="js/elo-tab.js"></script>
    <script src="js/modals.js"></script>

    <script>
        loadFromServer();
    </script>

</body>
</html>
